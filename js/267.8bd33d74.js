(globalThis["webpackChunktamponati_client"]=globalThis["webpackChunktamponati_client"]||[]).push([[267],{6267:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>y});var l=t(3673),d=t(8880),o=t(2323);const i={class:"q-pa-md"},n=(0,l.Uk)("Data"),u=(0,l.Uk)("Q.ta Tamponi"),r=(0,l.Uk)("Q.ta Tamponi disponibili"),s=(0,l.Uk)("Action");function c(e,a,t,c,m,p){const f=(0,l.up)("q-date"),w=(0,l.up)("q-popup-proxy"),D=(0,l.up)("q-icon"),Y=(0,l.up)("q-input"),_=(0,l.up)("q-item-label"),b=(0,l.up)("q-item-section"),W=(0,l.up)("q-btn"),q=(0,l.up)("q-item"),v=(0,l.up)("q-list"),h=(0,l.up)("q-form"),M=(0,l.Q2)("ripple");return(0,l.wg)(),(0,l.j4)("div",i,[(0,l.Wm)(h,{ref:"formRef",onSubmit:(0,d.iM)(e.addRow,["prevent"])},{default:(0,l.w5)((()=>[(0,l.Wm)(v,{class:"rounded-borders q-my-md",bordered:""},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{class:"items-start"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(Y,{modelValue:e.register.data,"onUpdate:modelValue":a[3]||(a[3]=a=>e.register.data=a),outlined:"",label:"Data",dense:"",mask:"##/##/####",rules:[e=>/^-?[0-3]\d\/[0-1]\d\/[\d]+$/.test(e)||"Campo Richiesto",a=>e.checkMajToday(a)||"La Data non deve essere nel passato"]},{append:(0,l.w5)((()=>[(0,l.Wm)(D,{name:"event",class:"cursor-pointer"},{default:(0,l.w5)((()=>[(0,l.Wm)(w,{ref:"qDateProxy"},{default:(0,l.w5)((()=>[(0,l.Wm)(f,{modelValue:e.register.data,"onUpdate:modelValue":[a[1]||(a[1]=a=>e.register.data=a),a[2]||(a[2]=()=>e.$refs.qDateProxy.hide())],mask:"DD/MM/YYYY",options:e.limitDateFn},null,8,["modelValue","options"])])),_:1},512)])),_:1})])),_:1},8,["modelValue","rules"])])),_:1})])),_:1}),(0,l.Wm)(b,{class:"text-weight-medium"},{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(Y,{ref:"qtaRef",modelValue:e.register.qta,"onUpdate:modelValue":a[4]||(a[4]=a=>e.register.qta=a),modelModifiers:{number:!0},outlined:"",label:"QuantitÃ ",dense:"",rules:[e=>!!e||"Campo Richiesto"]},null,8,["modelValue","rules"])])),_:1})])),_:1}),(0,l.Wm)(b,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(_,{class:"text-black"},{default:(0,l.w5)((()=>[(0,l.Wm)(W,{type:"submit",icon:"add",flat:"",round:"",color:"primary"})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["onSubmit"]),(0,l.Wm)(v,{class:"rounded-borders relative-position",bordered:"",separator:""},{default:(0,l.w5)((()=>[(0,l.Wm)(q,{class:"text-weight-medium"},{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[n])),_:1})])),_:1}),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[u])),_:1})])),_:1}),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[r])),_:1})])),_:1}),(0,l.Wm)(b,{class:"col-2 text-black",side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[s])),_:1})])),_:1})])),_:1}),(0,l.Wm)(d.W3,{name:"scale","move-class":"move-transition"},{default:(0,l.w5)((()=>[((0,l.wg)(!0),(0,l.j4)(l.HY,null,(0,l.Ko)(e.sortedCalendar,((a,t)=>(0,l.wy)(((0,l.wg)(),(0,l.j4)(q,{key:t,clickable:""},{default:(0,l.w5)((()=>[(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.data),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.qta),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(b,null,{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Uk)((0,o.zw)(a.qta_disponibile),1)])),_:2},1024)])),_:2},1024),(0,l.Wm)(b,{class:"col-2 text-black",side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(_,null,{default:(0,l.w5)((()=>[(0,l.Wm)(W,{icon:"delete",flat:"",onClick:t=>e.deleteRow(a)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1536)),[[M]]))),128))])),_:1})])),_:1})])}var m=t(1959),p=t(5720),f=t(5616),w=t(2490),D=t(3245);const Y=(0,l.aZ)({name:"PrenotaTamponePage",setup(){const e=(0,D.e)(),a=(0,m.iH)(null),t=(0,m.iH)(null),d=(0,m.iH)([]),o=(0,m.iH)({data:"",qta:"",qta_disponibile:""});w.db.collection("calendari").where("id_laboratorio","==",e.value.id).get().then((e=>{const a=[];e.forEach((e=>{a.push({data:f.ZP.formatDate(e.data().data.toDate(),"DD/MM/YYYY"),qta:e.data().qta,qta_disponibile:e.data().qta_disponibile})})),d.value=a}));const i=f.ZP.formatDate(Date.now(),"YYYY/MM/DD"),n=e=>e>=i,u=e=>f.ZP.extractDate(e,"DD/MM/YYYY")>=new Date,r=e=>d.value.findIndex((a=>a.data===e)),s=async()=>{const i=r(o.value.data);if(-1!==i){d.value[i].qta=o.value.qta;const a=await w.db.collection("calendari").where("id_laboratorio","==",e.value.id).where("data","==",p.Z.firestore.Timestamp.fromDate(f.ZP.extractDate(o.value.data,"DD/MM/YYYY"))).get();a.forEach((e=>{w.db.collection("calendari").doc(e.id).update({qta:o.value.qta})}))}else d.value.push({...o.value}),await w.db.collection("calendari").add({id_laboratorio:e.value.id,data:p.Z.firestore.Timestamp.fromDate(f.ZP.extractDate(o.value.data,"DD/MM/YYYY")),qta:parseInt(o.value.qta),qta_disponibile:parseInt(o.value.qta)});o.value.data=f.ZP.formatDate(f.ZP.addToDate(f.ZP.extractDate(o.value.data,"DD/MM/YYYY"),{days:1}),"DD/MM/YYYY"),o.value.qta="",await(0,l.Y3)(),a.value.resetValidation(),t.value.focus()},c=a=>{const t=r(a.data);w.db.collection("calendari").where("id_laboratorio","==",e.value.id).where("data","==",p.Z.firestore.Timestamp.fromDate(f.ZP.extractDate(a.data,"DD/MM/YYYY"))).get().then((e=>{e.forEach((e=>{w.db.collection("calendari").doc(e.id).delete()}))})),d.value.splice(t,1)},Y=()=>{const e=r(row.data);w.db.collection("calendari").where("data","<=",p.Z.firestore.Timestamp.fromDate(f.ZP.extractDate(row.data,"DD/MM/YYYY"))).get().then((e=>{e.forEach((e=>{w.db.collection("calendari").doc(e.id).delete()}))})),d.value.splice(e,1)},_=(0,l.Fl)((()=>{const e=[...d.value];return e.sort(((e,a)=>f.ZP.extractDate(e.data,"DD/MM/YYYY")-f.ZP.extractDate(a.data,"DD/MM/YYYY"))),e}));return{formRef:a,qtaRef:t,limitDateFn:n,checkMajToday:u,register:o,sortedCalendar:_,addRow:s,deleteRow:c,cancellaDateVecchie:Y}}});var _=t(8689),b=t(7011),W=t(3414),q=t(2035),v=t(2350),h=t(4842),M=t(4554),Z=t(3944),k=t(6915),g=t(8240),x=t(6489),P=t(7518),Q=t.n(P);Y.render=c;const y=Y;Q()(Y,"components",{QForm:_.Z,QList:b.Z,QItem:W.Z,QItemSection:q.Z,QItemLabel:v.Z,QInput:h.Z,QIcon:M.Z,QPopupProxy:Z.Z,QDate:k.Z,QBtn:g.Z}),Q()(Y,"directives",{Ripple:x.Z})}}]);